<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <title>Admin | All Leads | Family Values Group</title>

    <link rel="stylesheet" href="styles/agentstyle.css" />
    <link rel="stylesheet" href="styles/admin.css" />
    <link href="https://fonts.googleapis.com/css?family=Bellota+Text" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />

    <!-- Lock visual display until we confirm admin -->
    <style>
      html { visibility: hidden; }
      /* Make the admin page nav work with <a> links (your CSS was originally for buttons) */
      #admin-page-nav a{
        border: none;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      #admin-page-nav a.active{
        /* if your CSS already styles .active, this is harmless */
      }
    </style>

    <noscript>
      <meta http-equiv="refresh" content="0; url=dashboard.html">
    </noscript>
  </head>

  <body id="dashboardbody">

    <!-- Header (unchanged) -->
    <header class="index-grid-header">
      <div id="logofvcontainer">
        <div id="logodiv">
          <a href="../index.html"><img id="headerlogo" src="../Pics/img17.png" alt="FVIA Logo" /></a>
        </div>
        <div id="fvdiv">
          <p><strong>Family Values Group</strong></p>
        </div>
      </div>
      <div id="navcontainer">
        <nav class="header-flex-container">
          <a id="notifications-tab" href="notifications.html"><i class="fa-solid fa-bell"></i></a>
          <a id="profile-tab" href="profile.html"><i class="fa-solid fa-user"></i></a>
          <div id="menu-toggle">
            <i class="fa-solid fa-bars"></i>
          </div>
        </nav>
      </div>
    </header>

    <!-- Mobile Menu (unchanged) -->
    <div id="mobile-menu">
      <a href="dashboard.html"><i class="fa-solid fa-gauge"></i><p>Dashboard</p></a>

      <button id="toolkit-toggle" class="menu-item" aria-expanded="false" aria-controls="toolkit-submenu">
        <i class="fa-solid fa-toolbox"></i><span>Toolkit</span>
        <i class="fa-solid fa-chevron-down caret" aria-hidden="true"></i>
      </button>

      <div id="toolkit-submenu" class="submenu" hidden>
        <a href="leads.html"><i class="fa-solid fa-address-book"></i><span>Leads</span></a>
        <a href="maps.html"><i class="fa-solid fa-route"></i><span>Routing</span></a>
        <a href="scheduling.html"><i class="fa-solid fa-calendar-check"></i><span>Scheduling</span></a>
        <a href="calculator.html"><i class="fa-solid fa-calculator"></i><span>Calculator</span></a>
        <a href="marketing.html"><i class="fa-solid fa-handshake"></i><span>Marketing</span></a>
      </div>

      <a href="commissions.html"><i class="fa-solid fa-dollar-sign"></i><p>Commissions</p></a>
      <a href="training.html"><i class="fa-solid fa-chalkboard-teacher"></i><p>Training</p></a>
      <a href="recruiting.html"><i class="fa-solid fa-user-plus"></i><p>Recruiting</p></a>
      <a href="messages.html"><i class="fa-solid fa-envelope"></i><p>Messages</p></a>
      <a href="admin-all-leads.html"><i class="fa-solid fa-user-shield"></i><p>Admin</p></a>
    </div>

    <main class="auth-container">

      <!-- Admin page navigation (now links) -->
      <nav id="admin-page-nav">
        <a href="admin-all-leads.html" class="active" id="nav-all">All Leads</a>
        <a href="admin-lead-requests.html" id="nav-requests">Lead Requests</a>
        <a href="admin-assignment-history.html" id="nav-history">Assignment History</a>
        <a href="admin-agent-stats.html" id="nav-stats">Agent Stats</a>
        <a href="admin-commissions.html" id="nav-commissions">Commissions</a>
        <a href="admin-content.html" id="nav-content" class="admin-nav-btn">Content</a>
      </nav>

      <!-- ONLY: All Leads Section -->
      <section id="admin-all-section" class="admin-section">
        <h3>All Leads</h3>

        <div id="admin-all-container">
          <div id="admin-filters" class="filter-wrapper">
            <div class="filter-group">
              <label for="date-range">Date Range</label>
              <input id="date-range" placeholder="Select date range" readonly />
            </div>

            <div class="filter-group">
              <label for="date-order">Order</label>
              <select id="date-order">
                <option value="desc">Most Recent</option>
                <option value="asc">Oldest</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="agent-filter">Agent</label>
              <select id="agent-filter">
                <option value="">All Agents</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="assigned-filter">Assigned</label>
              <select id="assigned-filter">
                <option value="">Assigned &amp; Unassigned</option>
                <option value="true">Assigned</option>
                <option value="false">Unassigned</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="zip-filter">ZIP</label>
              <input type="text" id="zip-filter" placeholder="ZIP" />
            </div>

            <div class="filter-group">
              <label for="city-filter">City</label>
              <input type="text" id="city-filter" placeholder="City" />
            </div>

            <div class="filter-group">
              <label for="state-filter">State</label>
              <select id="state-filter">
                <option value="">All States</option>
                <option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option><option value="AR">Arkansas</option>
                <option value="CA">California</option><option value="CO">Colorado</option><option value="CT">Connecticut</option><option value="DE">Delaware</option>
                <option value="FL">Florida</option><option value="GA">Georgia</option><option value="HI">Hawaii</option><option value="ID">Idaho</option>
                <option value="IL">Illinois</option><option value="IN">Indiana</option><option value="IA">Iowa</option><option value="KS">Kansas</option>
                <option value="KY">Kentucky</option><option value="LA">Louisiana</option><option value="ME">Maine</option><option value="MD">Maryland</option>
                <option value="MA">Massachusetts</option><option value="MI">Michigan</option><option value="MN">Minnesota</option><option value="MS">Mississippi</option>
                <option value="MO">Missouri</option><option value="MT">Montana</option><option value="NE">Nebraska</option><option value="NV">Nevada</option>
                <option value="NH">New Hampshire</option><option value="NJ">New Jersey</option><option value="NM">New Mexico</option><option value="NY">New York</option>
                <option value="NC">North Carolina</option><option value="ND">North Dakota</option><option value="OH">Ohio</option><option value="OK">Oklahoma</option>
                <option value="OR">Oregon</option><option value="PA">Pennsylvania</option><option value="RI">Rhode Island</option><option value="SC">South Carolina</option>
                <option value="SD">South Dakota</option><option value="TN">Tennessee</option><option value="TX">Texas</option><option value="UT">Utah</option>
                <option value="VT">Vermont</option><option value="VA">Virginia</option><option value="WA">Washington</option><option value="WV">West Virginia</option>
                <option value="WI">Wisconsin</option><option value="WY">Wyoming</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="first-name-filter">First Name</label>
              <input type="text" id="first-name-filter" placeholder="First Name" />
            </div>

            <div class="filter-group">
              <label for="last-name-filter">Last Name</label>
              <input type="text" id="last-name-filter" placeholder="Last Name" />
            </div>

            <div class="filter-group">
              <label for="lead-type-filter">Product Type</label>
              <select id="lead-type-filter">
                <option value="">All Product Types</option>
                <option value="Life">Life Insurance</option>
                <option value="Health">Health Insurance</option>
                <option value="P&C">Property & Casualty Insurance</option>
                <option value="Legal">LegalShield/IDShield</option>
                <option value="Realty">Realty</option>
              </select>
            </div>

            <div class="filter-buttons">
              <button id="apply-filters">Apply Filters</button>
              <button id="reset-filters">Reset Filters</button>
            </div>
          </div>

          <!-- (kept hidden like you had it) -->
          <select id="sort-by" style="display:none;">
            <option value="created_at">created_at</option>
            <option value="first_name">first_name</option>
            <option value="last_name">last_name</option>
            <option value="age">age</option>
            <option value="phone">phone</option>
            <option value="address">address</option>
            <option value="city">city</option>
            <option value="state">state</option>
            <option value="zip">zip</option>
            <option value="lead_type">lead_type</option>
            <option value="submitted_by_name">submitted_by_name</option>
            <option value="notes">notes</option>
            <option value="product_type">product_type</option>
          </select>

          <div id="leads-table-container">
            <table id="leads-table">
              <thead>
                <tr>
                  <th><input type="checkbox" id="select-all"></th>
                  <th data-column="created_at">Submitted</th>
                  <th data-column="submitted_by_name">Agent</th>
                  <th data-column="first_name">First Name</th>
                  <th data-column="last_name">Last Name</th>
                  <th data-column="age">Age</th>
                  <th data-column="phone">Phone(s)</th>
                  <th data-column="address">Address</th>
                  <th data-column="city">City</th>
                  <th data-column="state">State</th>
                  <th data-column="zip">ZIP</th>
                  <th data-column="lead_type">Type</th>
                  <th data-column="notes">Notes</th>
                  <th data-column="product_type">Product</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>

            <div id="pagination-controls" style="margin-top:10px;">
              <button id="prev-page">Previous</button>
              <span id="current-page">Page 1</span>
              <button id="next-page">Next</button>
            </div>
          </div>

          <div id="bulk-export-invisible-container">
            <div id="bulk-export-container">
              <div id="bulk-assign-controls" style="margin-top: 10px;">
                <label for="bulk-assign-agent">Assign <span id="selected-count">0</span> lead(s) to:</label>
                <select id="bulk-assign-agent"></select>
                <button id="bulk-assign-btn">Assign</button>
              </div>

              <div id="export-controls" style="position: relative;">
                <button id="export-btn" style="margin:auto">Export</button>
                <div id="export-options" style="display:none; position:absolute; background:white; border:1px solid #ccc; padding:5px;">
                  <button id="export-pdf">PDF</button>
                  <button id="export-csv">CSV</button>
                  <button id="export-print">Print</button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </section>
    </main>

    <!-- Reassignment Warning Modal (kept) -->
    <div id="reassign-warning-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:9999; align-items:center; justify-content:center;">
      <div style="background:white; padding:20px; border-radius:10px; max-width:90vw; width:300px; text-align:center;">
        <p><strong>Warning!</strong> You are about to re-assign one or more leads. Would you still like to submit?</p>
        <div style="margin-top:20px;">
          <button id="cancel-reassign-btn" style="margin-right:10px;">Cancel</button>
          <button id="submit-anyway-btn">Submit Anyway</button>
        </div>
      </div>
    </div>

    <!-- Footer (unchanged) -->
    <footer class="index-grid-footer">
      <img id="footerlogo" src="Pics/img17.png">
      <hr class="footerhr">
      <div id="footercontact">
        <a class="contactcontainer" href="mailto:info@familyvaluesgroup.com">
          <span class="fa fa-envelope"></span>
          <span class="contactcontcontacts">info@familyvaluesgroup.com</span>
        </a>
        <p> | </p>
        <a class="contactcontainer" href="tel:+16292437980">
          <span class="fa fa-phone"></span>
          <span class="contactcontcontacts">+1-629-243-7980</span>
        </a>
      </div>
      <hr class="footerhr">
      <div id="footersocial">
        <a class="fab fa-facebook-f" href="https://www.facebook.com/familyvaluesgroup"></a>
        <a class="fab fa-linkedin-in" href="https://www.linkedin.com/in/demisi-johnson-026227391?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=ios_app"></a>
        <a class="fab fa-instagram" href="https://www.instagram.com/family.values.group?igsh=OHl3dGdnd3RwMTV0&utm_source=qr"></a>
        <a class="fab fa-youtube" href="https://youtube.com/@familyvaluesgroup?si=mauqWp5nxyczgCJd"></a>
        <a class="fab fa-google" href="https://g.page/r/CXUiEg9T9xHSEAE/review"></a>
      </div>
      <div id="footerlinks">
        <a href="faqs.html">FAQs</a>
        <a href="terms.html">Terms</a>
        <a href="accessibility.html">Accessibility</a>
        <a href="privacy.html">Privacy</a>
      </div>
      <p><em>Â© 2025 Family Values Group. All Rights Reserved.</em></p>
    </footer>

    <!-- Scripts (same stack, but replace scripts/admin.js with scripts/admin-all-leads.js) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script src="scripts/supabase-client.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="scripts/general.js"></script>
    <script src="scripts/admin-all-leads.js"></script>

    <!-- Admin-only gate (kept same) -->
    <script>
      (async () => {
        const supabase = window.supabaseClient;
        if (!supabase) return;

        const { data: { session } = {} } = await supabase.auth.getSession();
        if (!session) { location.replace('login.html'); return; }

        const { data: profile } = await supabase
          .from('agents')
          .select('is_admin')
          .eq('id', session.user.id)
          .maybeSingle();

        if (profile?.is_admin === true) {
          document.documentElement.style.visibility = 'visible';
        } else {
          location.replace('dashboard.html');
        }
      })();
    </script>
  </body>
</html>
